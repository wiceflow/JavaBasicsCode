# 数据库分表简单解释  

## 水平分表  

水平分表可以理解为以字段为依据，按照一定的策略（`hash` 、`range` 等），将一个表中的数据拆分到多个表中。每个表的结构都是一样的，但他们的数据不一样，没有交集。    

常见的有按日期分表，这种便是简单的 水平分表  

#### 场景  

在系统的绝对并发量没有上来，只是单表的数据量太多，影响了 `SQL` 的效率，加重了 `CPU` 的负担，以至于成为瓶颈，这时候就可以考虑水平分表了。  

#### 缺点  

水平分割会给应用增加复杂度，它通常在查询时需要多个表名，查询所有数据需要union操作。在许多数据库应用中，这种复杂性会超过它带来的优点，因为只 要索引关键字不大，则在索引用于查询时，表中增加两到三倍数据量，查询时也就增加读一个索引层的磁盘次数。  

## 垂直分表  

以字段为依据，按照字段的活跃性，将表中字段拆到不同的表中（主表和扩展表）。  每个表的结构都不一样，每个表的数据也不一样，一般来说，每个表的字段至少有一列交集，一般是主键，用于关联数据，所有表的数据并集便是全量数据。  

#### 场景  

系统绝对并发量并没有上来，表的记录并不多，但是字段多，并且热点数据和非热点数据在一起，单行数据所需的存储空间较大，以至于数据库缓存的数据行减少，查询时回去读磁盘数据产生大量随机读IO，产生IO瓶颈。  

可以用列表页和详情页来帮助理解。垂直分表的拆分原则是将热点数据（可能经常会查询的数据）放在一起作为主表，非热点数据放在一起作为扩展表，这样更多的热点数据就能被缓存下来，进而减少了随机读IO。拆了之后，要想获取全部数据就需要关联两个表来取数据。  

#### 缺点  

使用了垂直分表千万不能使用 `join` 查询，因为 `Join` 不仅会增加 `CPU` 负担并且会将两个表耦合在一起（必须在一个数据库实例上）。关联数据应该在 `service` 层进行，分别获取主表和扩展表的数据，然后用关联字段关联得到全部数据。

